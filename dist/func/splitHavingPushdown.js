"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.splitHavingPushdown=g;const d=require("./components/renameIdToField");function g(h){function n(t){if(t==null)return!0;if(Array.isArray(t))return t.every(n);if(typeof t!="object")return!0;if(t.$eq||t.$ne||t.$gt||t.$gte||t.$lt||t.$lte){const e=t.$eq||t.$ne||t.$gt||t.$gte||t.$lt||t.$lte;if(Array.isArray(e)&&e.length===2){let r=function(a){return typeof a=="string"&&a.startsWith("$_id.")||typeof a!="object"};const[i,l]=e;return r(i)&&r(l)}}for(const e of Object.keys(t))if(e.startsWith("$"))if(e==="$and"||e==="$or"){if(!n(t[e]))return!1}else return e==="$expr"?n(t[e]):!1;else if(!e.startsWith("_id.")||!n(t[e]))return!1;return!0}function f(t){return t.$expr?n(t.$expr):Object.keys(t).every(e=>e==="$and"||e==="$or"||e.startsWith("_id."))&&n(t)}function $(t){if(t.$and){const e=[],i=[];for(const l of t.$and){const r=$(l);e.push(...r.push),i.push(...r.rest)}return{push:e,rest:i}}return t.$or?f(t)?{push:[t],rest:[]}:{push:[],rest:[t]}:f(t)?{push:[t],rest:[]}:{push:[],rest:[t]}}const{push:s,rest:u}=$(h),c=s.length?s.length===1?s[0]:{$and:s}:null,o=u.length?u.length===1?u[0]:{$and:u}:null;return{pushable:c?(0,d.renameIdToField)(c):null,remaining:o}}
